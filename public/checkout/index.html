<!DOCTYPE html><html lang="es"> <head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><title>Finalizar Compra</title><link rel="stylesheet" href="/_astro/carrito.BjKxnswG.css"></head> <body class="bg-gray-50 text-gray-900"> <nav class="bg-white shadow-md p-4 mb-8"> <div class="container mx-auto flex justify-between items-center"> <a href="/" class="text-2xl font-bold text-blue-600">LIBRERIA</a> <div class="flex gap-4 items-center" id="nav-links"> <a href="/" class="hover:text-blue-500">Productos</a> <a href="/carrito" class="hover:text-blue-500"> Carrito</a> </div> </div> </nav> <main class="container mx-auto px-4">  <div class="max-w-2xl mx-auto mt-10 px-4"> <h1 class="text-2xl font-black mb-6 uppercase tracking-tight text-gray-800">Finalizar Pago</h1> <div id="summary" class="mb-8 p-6 bg-gray-50 rounded-lg border border-gray-200"> <h2 class="text-[10px] font-bold text-gray-400 uppercase mb-4 tracking-widest">Productos en tu bolsa</h2> <div id="items-list" class="space-y-3 text-sm"></div> </div> <form id="checkout-form" class="space-y-6"> <input type="hidden" id="form-fullName" value="APROBADO"> <input type="hidden" id="form-currency" value="USD"> <div class="bg-white p-6 rounded-xl border border-gray-100 shadow-sm space-y-4"> <h3 class="font-bold text-gray-700 text-sm uppercase">Informaci贸n de Tarjeta</h3> <div class="grid grid-cols-1 md:grid-cols-4 gap-4"> <div class="md:col-span-3"> <label class="block text-[10px] font-bold text-gray-500 uppercase mb-1">N煤mero de Tarjeta</label> <input type="text" id="form-cardNumber" value="4111111111111111" class="w-full border-b-2 border-gray-200 p-2 focus:border-blue-500 outline-none transition-colors font-mono" required> </div> <div> <label class="block text-[10px] font-bold text-gray-500 uppercase mb-1">CVV</label> <input type="text" id="form-cvv" value="123" class="w-full border-b-2 border-gray-200 p-2 focus:border-blue-500 outline-none transition-colors font-mono" required> </div> <div class="md:col-span-2"> <label class="block text-[10px] font-bold text-gray-500 uppercase mb-1">Mes Expiraci贸n (MM)</label> <input type="text" id="form-expMonth" value="01" class="w-full border-b-2 border-gray-200 p-2 focus:border-blue-500 outline-none transition-colors" required> </div> <div class="md:col-span-2"> <label class="block text-[10px] font-bold text-gray-500 uppercase mb-1">A帽o Expiraci贸n (YYYY)</label> <input type="text" id="form-expYear" value="2026" class="w-full border-b-2 border-gray-200 p-2 focus:border-blue-500 outline-none transition-colors" required> </div> </div> </div> <button type="submit" id="btn-submit" class="w-full bg-blue-600 text-white py-4 rounded font-bold uppercase tracking-widest hover:bg-blue-700 transition-all shadow-md active:translate-y-0.5">
Pagar y Confirmar Orden
</button> </form> </div> <script type="module">const r=JSON.parse(localStorage.getItem("cart")||"[]"),n=document.getElementById("items-list"),c="http://localhost:3000";r.length===0?(n.innerHTML='<p class="text-center text-gray-400">Tu carrito est谩 vac铆o</p>',document.getElementById("btn-submit").disabled=!0,document.getElementById("btn-submit").style.opacity="0.5"):n.innerHTML=r.map(e=>`
            <div class="flex justify-between font-medium">
                <span class="text-gray-600">${e.name} <span class="text-xs text-gray-400">x${e.quantity}</span></span>
                <span class="text-gray-900">$${(e.price*e.quantity).toFixed(2)}</span>
            </div>
        `).join("");document.getElementById("checkout-form").addEventListener("submit",async e=>{e.preventDefault();const a=document.getElementById("btn-submit");a.disabled=!0,a.innerText="PROCESANDO PAGO...";const o={items:r.map(t=>({productId:Number(t.productId),quantity:Number(t.quantity)})),paymentMethod:"CreditCard",paymentDetails:{cardNumber:document.getElementById("form-cardNumber").value,cvv:document.getElementById("form-cvv").value,expirationMonth:document.getElementById("form-expMonth").value,expirationYear:document.getElementById("form-expYear").value,fullName:document.getElementById("form-fullName").value,currency:"USD",description:"Compra segura de libros",reference:`WEB-${Date.now()}`}};try{const t=await fetch(`${c}/orders`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify(o)});if(t.ok)alert("隆Compra realizada con 茅xito!"),localStorage.removeItem("cart"),window.location.href="/perfil";else{const s=await t.json();alert("Error: "+(s.message||"No se pudo procesar el pago")),a.disabled=!1,a.innerText="Pagar y Confirmar Orden"}}catch{alert("Error de conexi贸n con la API"),a.disabled=!1}});</script>  </main> <script type="module">const t=localStorage.getItem("token"),e=document.getElementById("nav-links");t?(e.innerHTML+=`
					<a href="/perfil" class="hover:text-blue-500">Mi Perfil</a>
					<button id="logout" class="bg-red-500 text-white px-3 py-1 rounded">Salir</button>
				`,document.getElementById("logout")?.addEventListener("click",()=>{localStorage.removeItem("token"),window.location.href="/login"})):e.innerHTML+=`
					<a href="/login" class="hover:text-blue-500">Login</a>
					<a href="/registro" class="hover:text-blue-500 font-bold">Registro</a>
				`;</script> </body> </html>