<!DOCTYPE html><html lang="es"> <head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><title>Librer칤a Din치mica</title><link rel="stylesheet" href="/_astro/carrito.BjKxnswG.css"></head> <body class="bg-gray-50 text-gray-900"> <nav class="bg-white shadow-md p-4 mb-8"> <div class="container mx-auto flex justify-between items-center"> <a href="/" class="text-2xl font-bold text-blue-600">LIBRERIA</a> <div class="flex gap-4 items-center" id="nav-links"> <a href="/" class="hover:text-blue-500">Productos</a> <a href="/carrito" class="hover:text-blue-500">游 Carrito</a> </div> </div> </nav> <main class="container mx-auto px-4">  <div class="flex flex-col md:flex-row gap-6 mt-6"> <aside class="w-full md:w-72 bg-white p-5 rounded border border-gray-200 h-fit sticky top-4"> <h2 class="font-bold text-xs uppercase mb-4 text-gray-500 tracking-widest">Filtros Din치micos</h2> <form id="filter-form" class="space-y-4"> <div> <label class="text-[10px] font-bold uppercase text-gray-400">Palabra Clave</label> <input type="text" name="search" class="w-full mt-1 p-2 border rounded text-sm" placeholder="T칤tulo"> </div> <div> <label class="text-[10px] font-bold uppercase text-gray-400">Categor칤a</label> <select name="category" id="select-categories" class="w-full mt-1 p-2 border rounded text-sm"> <option value="">Cargando...</option> </select> </div> <div> <label class="text-[10px] font-bold uppercase text-gray-400">Etiqueta</label> <select name="tags" id="select-tags" class="w-full mt-1 p-2 border rounded text-sm"> <option value="">Cargando...</option> </select> </div> <div class="grid grid-cols-2 gap-2"> <div> <label class="text-[10px] font-bold uppercase text-gray-400">Precio M칤n</label> <input type="number" name="price_min" class="w-full mt-1 p-2 border rounded text-sm" placeholder="0"> </div> <div> <label class="text-[10px] font-bold uppercase text-gray-400">Precio M치x</label> <input type="number" name="price_max" class="w-full mt-1 p-2 border rounded text-sm" placeholder="999"> </div> </div> <button type="submit" class="w-full bg-blue-600 text-white py-2.5 rounded text-[10px] font-black uppercase hover:bg-blue-700 transition-colors">
Aplicar Filtros
</button> <button type="reset" id="btn-reset" class="w-full text-gray-400 py-1 text-[10px] uppercase hover:underline">
Limpiar Filtros
</button> </form> </aside> <main class="flex-1"> <div id="products-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4"></div> </main> </div> <script type="module">const n="http://localhost:3000",s=document.getElementById("products-grid"),l=document.getElementById("filter-form"),d=document.getElementById("select-categories"),u=document.getElementById("select-tags");async function g(){try{const[e,a]=await Promise.all([fetch(`${n}/categories`),fetch(`${n}/tags`)]),o=await e.json(),r=await a.json();d.innerHTML='<option value="">Todas las categor칤as</option>'+o.data.categories.map(t=>`<option value="${t.name}">${t.name}</option>`).join(""),u.innerHTML='<option value="">Cualquier etiqueta</option>'+r.data.tags.map(t=>`<option value="${t.id}">${t.name}</option>`).join("")}catch(e){console.error("Error filtros:",e)}}async function c(e=""){s.innerHTML='<div class="col-span-full text-center py-20 text-gray-400">Consultando cat치logo...</div>';try{const r=(await(await fetch(`${n}/products?${e}`)).json()).data.products||[];if(r.length===0){s.innerHTML='<div class="col-span-full text-center py-20 border-2 border-dashed rounded text-gray-400">Sin resultados</div>';return}s.innerHTML=r.map(t=>`
                <div class="bg-white border border-gray-100 p-5 rounded-lg flex flex-col hover:border-blue-400 transition-all">
                    <div class="flex justify-between items-start mb-2">
                        <span class="text-[9px] font-bold bg-blue-50 text-blue-500 px-2 py-0.5 rounded uppercase">${t.category.name}</span>
                        <span class="font-bold text-gray-900">$${t.price}</span>
                    </div>
                    <h3 class="font-bold text-gray-800 text-sm mb-1 uppercase">${t.name}</h3>
                    <p class="text-[10px] text-gray-400 mb-1 italic">Autor: ${t.author}</p>
                    
                    <p class="text-[10px] font-bold mb-3 ${t.stock>0?"text-green-600":"text-red-600"}">
                        STOCK DISPONIBLE: ${t.stock}
                    </p>

                    <p class="text-xs text-gray-500 line-clamp-2 mb-4 flex-grow leading-relaxed">${t.description}</p>
                    <div class="flex gap-1 mb-4 flex-wrap">
                        ${t.tags.map(i=>`<span class="text-[8px] bg-gray-50 text-gray-400 border border-gray-100 px-1.5 py-0.5 rounded">#${i.name}</span>`).join("")}
                    </div>
                    
                    <button 
                        onclick="addToCart({productId: ${t.id}, name: '${t.name.replace(/'/g,"\\'")}', price: ${t.price}, stock: ${t.stock}})"
                        class="w-full border-2 border-gray-900 py-2 rounded text-[10px] font-black uppercase hover:bg-gray-900 hover:text-white transition-all disabled:opacity-30 disabled:cursor-not-allowed"
                        ${t.stock<=0?"disabled":""}
                    >
                        ${t.stock>0?"Agregar al Carrito":"Agotado"}
                    </button>
                </div>
            `).join("")}catch{s.innerHTML='<div class="col-span-full text-center py-20 text-red-400">Error de API</div>'}}window.addToCart=e=>{const a=JSON.parse(localStorage.getItem("cart")||"[]"),o=a.find(t=>t.productId===e.productId);if((o?o.quantity:0)>=e.stock){alert(`No puedes agregar m치s. Solo quedan ${e.stock} unidades en stock.`);return}o?o.quantity+=1:a.push({...e,quantity:1}),localStorage.setItem("cart",JSON.stringify(a)),alert(`${e.name} a침adido al carrito.`)};l.addEventListener("submit",e=>{e.preventDefault();const a=new URLSearchParams(new FormData(l));c(a.toString())});document.getElementById("btn-reset").addEventListener("click",()=>{setTimeout(()=>c(),10)});g();c();</script>  </main> <script type="module">const t=localStorage.getItem("token"),e=document.getElementById("nav-links");t?(e.innerHTML+=`
					<a href="/perfil" class="hover:text-blue-500">Mi Perfil</a>
					<button id="logout" class="bg-red-500 text-white px-3 py-1 rounded">Salir</button>
				`,document.getElementById("logout")?.addEventListener("click",()=>{localStorage.removeItem("token"),window.location.href="/login"})):e.innerHTML+=`
					<a href="/login" class="hover:text-blue-500">Login</a>
					<a href="/registro" class="hover:text-blue-500 font-bold">Registro</a>
				`;</script> </body> </html>