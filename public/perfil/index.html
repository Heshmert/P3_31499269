<!DOCTYPE html><html lang="es"> <head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><title>Mi Perfil</title><link rel="stylesheet" href="/_astro/carrito.BjKxnswG.css"></head> <body class="bg-gray-50 text-gray-900"> <nav class="bg-white shadow-md p-4 mb-8"> <div class="container mx-auto flex justify-between items-center"> <a href="/" class="text-2xl font-bold text-blue-600">LIBRERIA</a> <div class="flex gap-4 items-center" id="nav-links"> <a href="/" class="hover:text-blue-500">Productos</a> <a href="/carrito" class="hover:text-blue-500">ðŸ›’ Carrito</a> </div> </div> </nav> <main class="container mx-auto px-4">  <div id="order-modal" class="fixed inset-0 bg-black/50 hidden z-50 flex items-center justify-center p-4 backdrop-blur-sm"> <div class="bg-white w-full max-w-2xl rounded-2xl shadow-2xl overflow-hidden animate-in fade-in zoom-in duration-200"> <div class="p-6 border-b flex justify-between items-center bg-gray-50"> <div> <h2 class="text-xl font-black uppercase" id="modal-order-id">Detalle de Orden</h2> <p class="text-[10px] text-gray-400 font-bold uppercase" id="modal-order-date"></p> </div> <button onclick="closeModal()" class="text-gray-400 hover:text-red-500 text-2xl font-bold">&times;</button> </div> <div id="modal-content" class="p-6 max-height-[70vh] overflow-y-auto space-y-4"></div> <div class="p-6 border-t bg-gray-50 flex justify-between items-center"> <span class="font-bold text-gray-500 uppercase text-xs">Total Pagado:</span> <span class="text-2xl font-black text-blue-600" id="modal-total"></span> </div> </div> </div> <div class="max-w-4xl mx-auto space-y-8 mt-10 px-4 pb-20"> <header class="bg-white p-8 rounded-2xl shadow-sm border border-gray-100 flex justify-between items-center"> <div> <h1 class="text-3xl font-black uppercase tracking-tighter text-gray-800">Panel de Usuario</h1> <p class="text-gray-400 text-sm font-medium">Historial de transacciones y pedidos.</p> </div> <button onclick="logout()" class="text-[10px] font-bold bg-red-50 text-red-500 px-4 py-2 rounded-full hover:bg-red-500 hover:text-white transition-all uppercase tracking-widest">
Cerrar SesiÃ³n
</button> </header> <section> <h2 class="text-xs font-black text-gray-400 uppercase tracking-widest mb-4">Mis Pedidos Recientes</h2> <div id="orders-container" class="space-y-4"> <p class="text-gray-500 italic">Consultando servidor...</p> </div> </section> </div> <script type="module">localStorage.getItem("token")||(window.location.href="/login");let a=[];async function d(){const n="http://localhost:3000",e=document.getElementById("orders-container"),r=localStorage.getItem("token");try{const t=await fetch(`${n}/orders`,{headers:{Authorization:`Bearer ${r}`,Accept:"application/json"}}),s=await t.json();if(t.ok&&s.status==="success"){if(a=s.data.orders||[],a.length===0){e.innerHTML='<div class="bg-white p-10 rounded-xl border border-dashed text-center"><p class="text-gray-400 uppercase font-bold text-xs">No hay compras registradas</p></div>';return}e.innerHTML=a.map(o=>`
                        <div class="bg-white p-6 rounded-xl border border-gray-100 flex justify-between items-center hover:shadow-md transition-all group">
                            <div class="space-y-2">
                                <div class="flex items-center gap-3">
                                    <span class="text-[10px] font-black bg-blue-600 text-white px-2 py-0.5 rounded italic">#ORD-${o.id}</span>
                                    <span class="text-xs font-bold text-gray-400 uppercase">${new Date(o.createdAt).toLocaleDateString()}</span>
                                </div>
                                <p class="font-black text-gray-900 text-xl tracking-tight">$${o.totalAmount.toFixed(2)}</p>
                                <p class="text-[10px] font-bold text-gray-500 uppercase tracking-widest">${o.items.length} Productos adquiridos</p>
                            </div>
                            <div class="flex flex-col items-end gap-3">
                                <span class="px-3 py-1 rounded-full text-[9px] font-black uppercase tracking-tighter ${o.status==="COMPLETED"?"bg-green-100 text-green-600":"bg-yellow-100 text-yellow-600"}">
                                    ${o.status}
                                </span>
                                <button onclick="showDetail(${o.id})" class="text-[10px] font-black text-blue-600 border-b-2 border-transparent hover:border-blue-600 uppercase tracking-widest transition-all">
                                    Ver Detalle â†’
                                </button>
                            </div>
                        </div>
                    `).join("")}else e.innerHTML='<p class="text-red-500">Error al cargar datos.</p>'}catch{e.innerHTML='<p class="text-red-500">Error de conexiÃ³n.</p>'}}window.showDetail=n=>{const e=a.find(t=>t.id===n);if(!e)return;document.getElementById("modal-order-id").innerText=`ORDEN #ORD-${e.id}`,document.getElementById("modal-order-date").innerText=`Fecha: ${new Date(e.createdAt).toLocaleString()}`,document.getElementById("modal-total").innerText=`$${e.totalAmount.toFixed(2)}`;const r=e.items.map(t=>`
                <div class="flex gap-4 items-center bg-gray-50 p-4 rounded-xl border border-gray-100">
                    <div class="w-12 h-12 bg-blue-600 rounded flex items-center justify-center text-white font-black text-xs">LIB</div>
                    <div class="flex-1">
                        <h4 class="text-sm font-black text-gray-800 uppercase leading-none mb-1">${t.product.name}</h4>
                        <p class="text-[10px] text-gray-500 font-bold uppercase tracking-tight italic">Autor: ${t.product.author}</p>
                    </div>
                    <div class="text-right">
                        <p class="text-xs font-black text-gray-900">${t.quantity} x $${t.unitPrice}</p>
                        <p class="text-[10px] font-bold text-blue-600">Sub: $${(t.quantity*t.unitPrice).toFixed(2)}</p>
                    </div>
                </div>
            `).join("");document.getElementById("modal-content").innerHTML=r,document.getElementById("order-modal").classList.remove("hidden"),document.body.style.overflow="hidden"};window.closeModal=()=>{document.getElementById("order-modal").classList.add("hidden"),document.body.style.overflow="auto"};window.logout=()=>{localStorage.clear(),window.location.href="/login"};d();</script>  </main> <script type="module">const t=localStorage.getItem("token"),e=document.getElementById("nav-links");t?(e.innerHTML+=`
					<a href="/perfil" class="hover:text-blue-500">Mi Perfil</a>
					<button id="logout" class="bg-red-500 text-white px-3 py-1 rounded">Salir</button>
				`,document.getElementById("logout")?.addEventListener("click",()=>{localStorage.removeItem("token"),window.location.href="/login"})):e.innerHTML+=`
					<a href="/login" class="hover:text-blue-500">Login</a>
					<a href="/registro" class="hover:text-blue-500 font-bold">Registro</a>
				`;</script> </body> </html>